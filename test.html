<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation Test Suite</title>
    <style>
        body {
            font-family: 'Monaco', 'Consolas', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .test-output {
            background: #000;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            max-height: 80vh;
            overflow-y: auto;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .info { color: #4488ff; }
        .warning { color: #ffaa00; }
        h1 { color: #ffffff; }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>üß™ Random Intersection Graph Simulation Test Suite</h1>
    
    <div>
        <button onclick="runTests()">üöÄ Run All Tests</button>
        <button onclick="clearOutput()">üóëÔ∏è Clear Output</button>
        <button onclick="runSimulation()">‚ñ∂Ô∏è Test Simulation</button>
    </div>
    
    <div id="output" class="test-output">
Click "Run All Tests" to start automated testing...
    </div>

    <script type="module">
        let output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'success': '‚úÖ',
                'error': '‚ùå', 
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            }[type] || '‚ÑπÔ∏è';
            
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${timestamp}] ${prefix} ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        window.clearOutput = () => {
            output.innerHTML = '';
        };
        
        window.runTests = async () => {
            clearOutput();
            log('Starting Random Intersection Graph Test Suite', 'info');
            log('='.repeat(60), 'info');
            
            try {
                // Test 1: Import and create basic models
                log('Test 1: Basic Model Creation', 'info');
                
                const { Person } = await import('./js/models/Person.js');
                const { Group } = await import('./js/models/Club.js');
                const { getCurrentConfig } = await import('./js/config.js');
                
                // Create test objects
                const person1 = new Person(0, 1);
                const person2 = new Person(1, -1);
                const group1 = new Group(0, 1.0);
                
                log(`Created Person 1: ID=${person1.id}, Opinion=${person1.getOpinion()}`, 'success');
                log(`Created Person 2: ID=${person2.id}, Opinion=${person2.getOpinion()}`, 'success');
                log(`Created Group 1: ID=${group1.id}, Weight=${group1.weight}`, 'success');
                
                // Test connections
                person1.addToGroup(group1);
                group1.addPerson(person1);
                
                if (person1.getGroups().has(group1) && group1.isMember(person1)) {
                    log('Person-Group connection successful', 'success');
                } else {
                    log('Person-Group connection failed', 'error');
                }
                
                // Test 2: Graph Initialization
                log('Test 2: Graph Initialization', 'info');
                
                const { GraphInitializer } = await import('./js/simulation/GraphInitializer.js');
                const config = getCurrentConfig();
                
                // Small test config
                const testConfig = { ...config, n: 5, m: 2 };
                const initializer = new GraphInitializer(testConfig);
                const { people, groups } = initializer.createGraph();
                
                log(`Graph created: ${people.length} people, ${groups.length} groups`, 'success');
                
                let totalConnections = 0;
                people.forEach(person => totalConnections += person.getGroups().size);
                log(`Total connections: ${totalConnections}`, 'info');
                
                // Test 3: Simulator
                log('Test 3: Simulator Creation and Turn', 'info');
                
                const { Simulator } = await import('./js/simulation/Simulator.js');
                const simulator = new Simulator(people, groups, testConfig);
                
                log('Simulator created successfully', 'success');
                
                // Test one simulation turn
                const initialStats = simulator.getStatistics();
                log(`Initial: Turn ${initialStats.currentTurn}, Edges ${initialStats.totalEdges}`, 'info');
                
                const turnResult = simulator.takeTurn();
                log(`Turn completed: Turn ${turnResult.turn}, Edge changes: ${turnResult.edgeChanges}, Opinion changes: ${turnResult.opinionChanges}`, 'success');
                
                // Test 4: Visualizer
                log('Test 4: Visualizer Initialization', 'info');
                
                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 300;
                const ctx = canvas.getContext('2d');
                
                const { CanvasVisualizer } = await import('./js/visualization/CanvasVisualizer.js');
                const visualizer = new CanvasVisualizer(canvas, ctx, 400, 300);
                visualizer.initialize(groups, people);
                
                log('Visualizer initialized successfully', 'success');
                
                log('='.repeat(60), 'info');
                log('üéâ All tests completed successfully!', 'success');
                
            } catch (error) {
                log(`Test failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        };
        
        window.runSimulation = async () => {
            clearOutput();
            log('Running extended simulation test...', 'info');
            
            try {
                const { GraphInitializer } = await import('./js/simulation/GraphInitializer.js');
                const { Simulator } = await import('./js/simulation/Simulator.js');
                const { getCurrentConfig } = await import('./js/config.js');
                
                const config = getCurrentConfig();
                const testConfig = { ...config, n: 20, m: 5 };
                
                log(`Creating graph: ${testConfig.n} people, ${testConfig.m} groups`, 'info');
                
                const initializer = new GraphInitializer(testConfig);
                const { people, groups } = initializer.createGraph();
                
                const simulator = new Simulator(people, groups, testConfig);
                
                log('Running 10 simulation turns...', 'info');
                
                for (let i = 0; i < 10; i++) {
                    const result = simulator.takeTurn();
                    const stats = simulator.getStatistics();
                    
                    log(`Turn ${result.turn}: Edges=${stats.totalEdges}, +1=${stats.opinionDistribution[1] || 0}, -1=${stats.opinionDistribution[-1] || 0}`, 'info');
                    
                    if (simulator.convergenceReached) {
                        log('Simulation converged!', 'success');
                        break;
                    }
                }
                
                log('Simulation test completed successfully', 'success');
                
            } catch (error) {
                log(`Simulation test failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        };
        
    </script>
</body>
</html> 